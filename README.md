# Telegram Mini App — Счётчик кликов (Flask + aiogram)

Локальное мини‑приложение Telegram, считающее количество нажатий на кнопку для каждого пользователя. 
Бэкенд на Flask + SQLite, бот на aiogram 3.

## Быстрый старт

1) Активация окружения (если ещё не активировано):

```
cd тест
.\\env\\Scripts\\Activate.ps1
```

2) Установка зависимостей:

```
pip install -r requirements.txt
```

3) Настройка переменных окружения:

- Скопируйте `.env.example` в `.env` и заполните `BOT_TOKEN` и при необходимости `APP_URL`.
- В дев‑режиме `DEV_MODE=true` позволяет тестировать без Telegram, используя `?user_id=123`.

4) Запуск веб‑приложения (Flask):

```
$env:FLASK_APP = "webapp.app"
flask run --reload --port 8000
```

Страница доступна на `http://localhost:8000`. Вне Telegram можно передать `?user_id=123`.

5) Запуск бота:

```
python bot/bot.py
```

В Telegram отправьте `/start` боту. Появится кнопка, открывающая мини‑приложение по `APP_URL`.

## Как это работает

- `POST /api/count` — получить текущий счётчик для пользователя.
- `POST /api/click` — инкрементировать счётчик и вернуть новое значение.
- Идентификация пользователя:
  - В Telegram: через `initData` (подпись валидируется, если указан `BOT_TOKEN`).
  - В дев‑режиме: через `?user_id=...` или тело запроса `user_id`.

База данных `SQLite` находится в `webapp/counter.db`.

## Замечания

- Для реального продакшена включите валидацию `initData` (убедитесь, что `BOT_TOKEN` задан) и отключите `DEV_MODE`.
- На мобильном устройстве для доступа к локальному серверу понадобится HTTPS‑туннель (например, ngrok).
